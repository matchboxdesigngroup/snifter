/**
* Variables
*/var wpba={};wpba.updateSortOrder=function(e){var t=jQuery,n=e.find("li"),r=[],i={action:"wpba_update_sort_order"},s=t(".wpba-saving");n.each(function(){var e=t(this);r.push(e.data("id"))});i.attids=r;s.removeClass("hide");t.post(ajaxurl,i,function(e){s.addClass("hide");return!1})};wpba.updateSortOrderClickHandler=function(){var e=jQuery,t=e("#wpba_image_sortable");t.sortable();t.on("sortupdate",function(e,n){wpba.updateSortOrder(t)})};wpba.unattachAttachment=function(e){var t=jQuery,n=t("#wpba_image_sortable"),r=e.parent("li").parent("ul").parent("div"),i=r.data("id"),s={action:"wpba_unattach_attachment",attachmentid:i},o=t(".wpba-saving");o.removeClass("hide");t.post(ajaxurl,s,function(e){var r=t.parseJSON(e);if(r){t("#attachment_"+i).remove();wpba.updateSortOrder(n)}})};wpba.unattachAttachmentClickHandler=function(){$=jQuery;$(".wpba-unattach").on("click",function(e){wpba.unattachAttachment($(this));e.preventDefault();return!1})};wpba.unattachLibraryAttachmentClickHandler=function(){$=jQuery;$(".wpba-unattach-library").on("click",function(e){var t=$(this),n=t.data("id"),r={action:"wpba_unattach_attachment",attachmentid:n};$.post(ajaxurl,r,function(e){var r=$.parseJSON(e);if(r){$("#post-"+n+" .reattach").remove();$("#post-"+n+" .unattach").remove();$(".wpba-list-spacer").removeClass("wpba-list-spacer");t.parents(".unattach-wrap").remove();$("#post-"+n+" .view").empty().append('<a href="http://localhost/~mothership/plugin-dev/?attachment_id='+n+'" title="View “Hello world!”" rel="permalink">View</a>');$("#post-"+n+" .column-parent").empty().append("(Unattached)<br><a class=\"hide-if-no-js\" onclick=\"findPosts.open( 'media[]','"+n+"'"+' ); return false;" href="#the-list">Attach</a>')}});e.preventDefault();return!1})};wpba.deleteAttachment=function(e){var t=jQuery,n=confirm("Are you sure you want to permanently delete this attachment? This will permanently remove the attachment from the media gallery!!"),r=t(".wpba-saving"),i=t("#wpba_image_sortable");if(n){var s=e.parent("li").parent("ul").parent("div"),o=s.data("id"),u={action:"wpba_delete_attachment",attachmentid:o};r.removeClass("hide");t.post(ajaxurl,u,function(e){var n=t.parseJSON(e);if(n){t("#attachment_"+o).remove();wpba.updateSortOrder(i)}r.addClass("hide")})}};wpba.deleteAttachmentClickHandler=function(){$=jQuery;$(".wpba-delete").on("click",function(e){wpba.deleteAttachment($(this));e.preventDefault();return!1})};wpba.refreshAttachments=function(e){var t=jQuery,n={action:"wpba_refresh_attachments",postid:t(".wpba").data("postid")},r=t("#wpba_image_sortable");t.getJSON(ajaxurl,n,function(e){r.empty().append(e);wpba.resetClickHandlers()});return!1};wpba.editModalClickHandler=function(){$=jQuery;if($("#wpba_edit_screen").length>0){$(".wpba-edit").on("click",function(e){var t=$(this);attid=wpba.showEditScreenModal(t);e.preventDefault();return!1});$("#wpba_edit_screen_close").on("click",function(e){var t=$(this);wpba.refreshAttachments(attid);$("#wpba_edit_screen").hide();e.preventDefault();return!1})}};wpba.showEditScreenModal=function(e){var t=$("#wpba_edit_screen"),n=t.find("iframe"),r=t.data("settings"),i;n.attr("src",e.attr("href"));n.load(function(){css="#adminmenuwrap,#adminmenuback,#wpadminbar,#screen-meta-links,#wpfooter,.add-new-h2 { display: none; }#wpcontent { width: 96%; margin: 0 2%; }";r.caption&&(css+=' #attachment_caption, label[for="attachment_caption"] { display: none; }');r.alt&&(css+=' #wp-attachment_content-wrap, label[for="content"] { display: none; }');r.description&&(css+='#attachment_alt, label[for="attachment_alt"] { display: none; }');n.contents().find("head").append($("<style type='text/css'>"+css+"</style>"));i=n.contents().find("#post_ID").val();n.contents().find("#publish").on("click",function(){n.hide();n.load(function(){n.contents().find("head").append($("<style type='text/css'>"+css+"</style>"));n.show()})});t.show();return i})};wpba.updatePost=function(e,t,n){var r=jQuery,i=i!=undefined?i:!1;ajaxData={action:"wpba_update_post",id:e,key:t,value:n};r.post(ajaxurl,ajaxData,function(e){})};wpba.titleBlurHandler=function(){var e=jQuery;e(".wpba-attachment-title").on("blur",function(){var t=e(this),n=t.parent("div").parent("div").data("id");wpba.updatePost(n,"post_title",t.val())})};wpba.captionBlurHandler=function(){var e=jQuery;e(".wpba-attachment-caption").on("blur",function(){var t=e(this),n=t.parent("div").parent("div").data("id");wpba.updatePost(n,"post_excerpt",t.val())})};wpba.resetClickHandlers=function(){wpba.updateSortOrderClickHandler();wpba.unattachAttachmentClickHandler();wpba.unattachLibraryAttachmentClickHandler();wpba.deleteAttachmentClickHandler();wpba.editModalClickHandler();wpba.titleBlurHandler();wpba.captionBlurHandler()};wpba.settingsDisablePostTypes=function(e){var t=$("#wpba-"+e.val()+"-disable-attachment-types-wrap"),n=t.parents("tr"),r=$("#wpba-"+e.val()+"-settings-wrap"),i=r.parents("tr"),s=$(".wpba-"+e.val()+"-meta-box-title"),o=s.parents("tr"),u=$(".wpba-"+e.val()+"-enabled-pages"),a=u.parents("tr"),f=$("#wpba-global-settings-wrap").parents("tr"),l=$("#wpba-meta-box-settings-wrap").parents("tr"),c=$("#wpba-edit-modal-settings-wrap").parents("tr"),h=$("#wpba-disable-attachment-types-wrap").parents("tr"),p=$('#wpba-disable-post-types-wrap input[type="checkbox"]'),d=!0;p.each(function(){if(!$(this).is(":checked")){d=!1;return}});if(d){f.hide();l.hide();c.hide();h.hide()}else{f.show();l.show();c.show();h.show()}d=!0;if(e.is(":checked")){i.hide();n.hide();o.hide();a.hide()}else{i.show();n.show();o.show();a.show()}$(".wpba-loading").removeClass("wpba-loading");$("#wpba_settings").animate({opacity:1},150);$(".wpba-settings-sidebar").animate({opacity:1},150)};wpba.globalSettingsHandler=function(e,t){elem=$(t);if(e.is(":checked")){elem.hide();elem.next("br").hide()}else{elem.show();elem.next("br").show()}$("#wpba_settings").animate({opacity:1},150);$(".wpba-settings-sidebar").animate({opacity:1},150)};wpba.settingsCheckBoxSetupHandler=function(e,t){e.on("change",function(){wpba.globalSettingsHandler($(this),t)}).each(function(){wpba.globalSettingsHandler($(this),t)})};jQuery(function(e){e(window).load(function(){wpba.resetClickHandlers();var t=e('#wpba-disable-post-types-wrap input[type="checkbox"]'),n=e(".wpba-settings-hide"),r=e('input[type="checkbox"].wpba-settings-thumbnail'),i=e('input[type="checkbox"].wpba-settings-no_crop_editor'),s=e('input[type="checkbox"].wpba-settings-gmb_title'),o=e('input[type="checkbox"].wpba-settings-gmb_caption'),u=e('input[type="checkbox"].wpba-settings-gmb_show_attachment_id'),a=e('input[type="checkbox"].wpba-settings-gmb_unattach_link'),f=e('input[type="checkbox"].wpba-settings-gmb_edit_link'),l=e('input[type="checkbox"].wpba-settings-gmb_delete_link'),c=e('input[type="checkbox"].wpba-settings-gem_caption'),h=e('input[type="checkbox"].wpba-settings-gem_alternative_text'),p=e('input[type="checkbox"].wpba-settings-gem_description'),d=e('input[type="checkbox"].wpba-settings-disable_image'),v=e('input[type="checkbox"].wpba-settings-disable_video'),m=e('input[type="checkbox"].wpba-settings-disable_audio'),g=e('input[type="checkbox"].wpba-settings-disable_document');n.on("click",function(t){var n=e(this),r=n.parents("th").siblings("td");if(n.text()=="hide"){r.hide();n.text("show")}else{r.show();n.text("hide")}t.preventDefault();return!1});wpba.settingsCheckBoxSetupHandler(d,".wpba-settings-pt_disable_image");wpba.settingsCheckBoxSetupHandler(v,".wpba-settings-pt_disable_video");wpba.settingsCheckBoxSetupHandler(m,".wpba-settings-pt_disable_audio");wpba.settingsCheckBoxSetupHandler(g,".wpba-settings-pt_disable_document");wpba.settingsCheckBoxSetupHandler(c,".wpba-settings-em_caption");wpba.settingsCheckBoxSetupHandler(h,".wpba-settings-em_alternative_text");wpba.settingsCheckBoxSetupHandler(p,".wpba-settings-em_description");wpba.settingsCheckBoxSetupHandler(s,".wpba-settings-title");wpba.settingsCheckBoxSetupHandler(o,".wpba-settings-caption");wpba.settingsCheckBoxSetupHandler(u,".wpba-settings-mb_show_attachment_id");wpba.settingsCheckBoxSetupHandler(a,".wpba-settings-mb_unattach_link");wpba.settingsCheckBoxSetupHandler(f,".wpba-settings-mb_edit_link");wpba.settingsCheckBoxSetupHandler(l,".wpba-settings-mb_delete_link");wpba.settingsCheckBoxSetupHandler(i,".wpba-settings-all_crop_sizes");wpba.settingsCheckBoxSetupHandler(r,".wpba-settings-mb_thumbnail");t.on("change",function(){wpba.settingsDisablePostTypes(e(this))}).each(function(){wpba.settingsDisablePostTypes(e(this))})})}(jQuery));jQuery(function(e){e(window).load(function(){e("#wpba_attachments_button").on("click",function(){tb_show("","media-upload.php?type=image&amp;TB_iframe=true");window.original_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){imgurl=jQuery(t).attr("src");imgurl||(imgurl=jQuery("img",t).attr("src"));imgurl||(imgurl=jQuery(t).attr("href"));var n=e("#wpba_image_sortable"),r=e(".wpba-saving"),i={attachmenturl:imgurl,action:"wpba_add_attachment_old",parentid:e(".wpba").data("postid")};r.removeClass("hide");e.post(ajaxurl,i,function(t){resp=e.parseJSON(t);if(resp){n.append(resp.image);wpba.updateSortOrder(n);wpba.resetClickHandlers()}});tb_remove();window.send_to_editor=window.original_send_to_editor};return!1})})}(jQuery));